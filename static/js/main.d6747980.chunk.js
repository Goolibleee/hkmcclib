(this.webpackJsonplibrary=this.webpackJsonplibrary||[]).push([[0],{152:function(e){e.exports=JSON.parse('{"en":{"titleLong":"Holy Korean Martyrs Catholic Church Library","titleShort":"HKMCC Library","idHolder":"Enter User ID","pwHolder":"Enter email or phone","bookHolder":"Enter book ID","logIn":"Log In","logOut":"Log Out","logInSucceed":"Logged in","logInFail":"Log In Failed","nameSuffix":"","home":"Home","checkOutStatus":"Check Out Status","bookSearch":"Book Search","userSearch":"User Search","checkOut":"Check Out","return":"Return","history":"Rent History","loading":"Loading DB","succeededToOpen":"Succeeded to load","searchUser":"Enter name or ID","searchBook":"Enter book keywords","failedToOpen":"Failed to open DB Refresh page later","available":"Available","checkedOut":"Checked out","reserved":"Reserved","overDue":"Overdue","lost":"Lost","damaged":"Damanged","given":"Given","notAvailable":"Not available","deleted":"Deleted","id":"ID","bookName":"Book name","rentDate":"Rent date","returnDate":"Return date","noEntry":"No entry","notice":"Notice","autoLogin":"AutoLogin","userMode":"User Mode","adminMode":"Admin Mode","normal":"Normal","stopped":"Stopped","homeText":"<div class=\\"container\\"><h2>Library Hours:</h2> <ul> <li>Every Sunday 9:30am~12:00pm</li> </ul> <h2>Book Borrowing:</h2> <ul> <li>Every Sunday 10:30am~12:00pm</li> <li>Maximum number of books for borrowing: 5</li> <li>Borrowing period: 3 weeks (Please request an extension from a volunteer at the time of borrowing or send an extension request email to <a href=\'mailto:hkmcc.library@gmail.com\'>hkmcc.library@gmail.com</a>)</li> <li>Book return: Please return the books to the return box in front of the library or directly to the library volunteers.</li> <li>Request for desired books: Please fill out and submit the desired book request form provided at the library.</li> </ul> <h2>For other inquiries:</h2> <ul> <li>Please contact the library by email at <a href=\'mailto:hkmcc.library@gmail.com\'>hkmcc.library@gmail.com</a>.</li> </ul></div>","INVALID_BOOK":"Unregistered book","INVALID_USER":"Invalid user","NOT_AVAILABLE":"Not available","OVERDUE":"Overdue account","RENTED":"Already rented book","MAX_RENTAL":"Max rent reached","NOT_RENTED":"Not a rented book","rentSucceed":"Rented","returnSucceed":"Returned","rentSuffix":" book(s) rented","confirmRent":"Rent this book?","confirmReturn":"Return this book?"},"kr":{"titleLong":"\ucc9c\uc8fc\uad50 \uc0b0\ud638\uc138 \ud55c\uad6d \uc21c\uad50\uc790 \uc131\ub2f9 \ub3c4\uc11c\uad00","titleShort":"HKMCC \ub3c4\uc11c\uad00","idHolder":"\ud68c\uc6d0\ubc88\ud638\ub97c \uc785\ub825\ud558\uc138\uc694","pwHolder":"\uc774\uba54\uc77c\uc774\ub098 \uc804\ud654\ubc88\ud638\ub97c \uc785\ub825\ud558\uc138\uc694","bookHolder":"\ub3c4\uc11c \ubc88\ud638\ub97c \uc785\ub825\ud558\uc138\uc694","logIn":"\ub85c\uadf8\uc778","logOut":"\ub85c\uadf8\uc544\uc6c3","logInSucceed":"\ub85c\uadf8\uc778 \uc131\uacf5","logInFail":"\ub85c\uadf8\uc778 \uc2e4\ud328","nameSuffix":" \ub2d8","home":"\ud648","checkOutStatus":"\ub300\ucd9c \uae30\ub85d \uc870\ud68c","bookSearch":"\ub3c4\uc11c \uac80\uc0c9","userSearch":"\ud68c\uc6d0 \uac80\uc0c9","checkOut":"\ub300\ucd9c","return":"\ubc18\ub0a9","history":"\ub300\ucd9c \uc774\ub825","loading":"DB \uc870\ud68c \uc911","succeededToOpen":"DB \uc870\ud68c \uc644\ub8cc","searchUser":"\uc774\ub984 \ub610\ub294 \ud68c\uc6d0\ubc88\ud638\ub97c \uc785\ub825\ud558\uc138\uc694","searchBook":"\ucc45 \ud0a4\uc6cc\ub4dc\ub97c \uc785\ub825\ud558\uc138\uc694","failedToOpen":"DB \uc870\ud68c\uac00 \uc2e4\ud328\ud558\uc600\uc2b5\ub2c8\ub2e4 \uc7a0\uc2dc \ud6c4 \ud654\uba74\uc744 \uac31\uc2e0\ud574\uc8fc\uc138\uc694","available":"\ub300\ucd9c\uac00\ub2a5","checkedOut":"\ub300\ucd9c\uc911","reserved":"\uc608\uc57d\uc911","overDue":"\uc5f0\uccb4\uc911","lost":"\ubd84\uc2e4","damaged":"\ud30c\uc190","given":"\uae30\uc99d","notAvailable":"\ub300\ucd9c\ubd88\uac00","deleted":"\ud3d0\uae30","id":"\ubc88\ud638","bookName":"\ub3c4\uc11c\uba85","rentDate":"\ub300\ucd9c\uc77c","returnDate":"\ubc18\ub0a9\uc77c","noEntry":"\ub0b4\uc5ed \uc5c6\uc74c","notice":"\uacf5\uc9c0 \uc0ac\ud56d","autoLogin":"\uc790\ub3d9 \ub85c\uadf8\uc778","userMode":"\uc77c\ubc18 \ubaa8\ub4dc","adminMode":"\uad00\ub9ac\uc790 \ubaa8\ub4dc","normal":"\uc815\uc0c1","stopped":"\ub300\ucd9c\uc911\uc9c0","homeText":"<div class=\\"container\\"><h2>\ub3c4\uc11c\uad00 \uac1c\ubc29\uc2dc\uac04:</h2><ul><li>\ub9e4 \uc8fc\uc77c(\uc77c) 9:30am~12:00pm</li></ul><h2>\ub3c4\uc11c \ub300\ucd9c:</h2><ul><li>\ub9e4 \uc8fc\uc77c 10:30am~12:00pm </li><li>\ub300\ucd9c \uad8c\uc218: \ucd5c\ub300 5\uad8c</li><li>\ub300\ucd9c \uae30\uac04: 3\uc8fc (\ub3c4\uc11c \ub300\ucd9c\uc2dc\uac04\uc5d0 \ubd09\uc0ac\uc790\uc5d0\uac8c \uc5f0\uc7a5\uc744 \uc694\uccad\ud558\uc2dc\uac70\ub098, <a href=\'mailto:hkmcc.library@gmail.com\'>hkmcc.library@gmail.com</a>\uc73c\ub85c \uc5f0\uc7a5 \uc2e0\uccad \uba54\uc77c\uc744 \ubcf4\ub0b4\uc2dc\uae30 \ubc14\ub78d\ub2c8\ub2e4.)</li><li>\ub3c4\uc11c \ubc18\ub0a9: \ub3c4\uc11c\uad00 \uc55e \ubc18\ub0a9\ud568\uc5d0 \ub123\uc5b4 \uc8fc\uc2dc\uac70\ub098 \ub3c4\uc11c\uad00 \ubd09\uc0ac\uc790\uc5d0\uac8c \uc9c1\uc811 \ubc18\ub0a9\ud558\uc5ec \uc8fc\uc2ed\uc2dc\uc624.</li><li>\ud76c\ub9dd \ub3c4\uc11c \uc2e0\uccad: \ub3c4\uc11c\uad00\uc5d0 \ube44\uce58\ub41c \ud76c\ub9dd \ub3c4\uc11c \uc2e0\uccad\uc11c\uc5d0 \uc791\uc131\ud558\uc5ec \uc81c\ucd9c\ud558\uc5ec \uc8fc\uc138\uc694.</li></ul></p><h2>\ubb38\uc758:</h2><ul><li>\ub3c4\uc11c\uad00 \uad00\ub828 \ubb38\uc758\ub294 \ub3c4\uc11c\uad00 \uc774\uba54\uc77c \uc8fc\uc18c <a href=\'mailto:hkmcc.library@gmail.com\'>hkmcc.library@gmail.com</a>\ub85c \ubb38\uc758 \ubc14\ub78d\ub2c8\ub2e4.</li></ul></div>","INVALID_BOOK":"\ub4f1\ub85d\ub418\uc9c0 \uc54a\uc740 \ub3c4\uc11c\uc785\ub2c8\ub2e4","INVALID_USER":"\ub4f1\ub85d\ub418\uc9c0 \uc54a\uc740 \ud68c\uc6d0\uc785\ub2c8\ub2e4","NOT_AVAILABLE":"\ub300\ucd9c \ubd88\uac00 \ub3c4\uc11c\uc785\ub2c8\ub2e4","OVERDUE":"\uc5f0\uccb4\uc911\uc785\ub2c8\ub2e4","RENTED":"\ub300\ucd9c\ub41c \ub3c4\uc11c\uc785\ub2c8\ub2e4","MAX_RENTAL":"\ub300\ucd9c \uad8c\uc218\ub97c \ucd08\uacfc\ud558\uc600\uc2b5\ub2c8\ub2e4","NOT_RENTED":"\ub300\ucd9c\ub418\uc9c0 \uc54a\uc740 \ub3c4\uc11c\uc785\ub2c8\ub2e4","rentSucceed":"\ub300\ucd9c \uc644\ub8cc","returnSucceed":"\ubc18\ub0a9 \uc644\ub8cc","rentSuffix":"\uad8c \ub300\ucd9c \uc911","confirmRent":"\ub300\ucd9c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?","confirmReturn":"\ubc18\ub0a9\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"}}')},219:function(e){e.exports=JSON.parse('{"privateKey":"-----BEGIN RSA PRIVATE KEY-----\\nMIICYAIBAAKBgQCrjaN6qZ81C0wl1uegCHbI/psEvpTNzBCS42ZwvVDq2y69kXfx\\nkDygmKqWi8rTFm6lx474GOAKpneEQ3ragP017HbW55hrXhQu2jK/UE5OPdIImPF5\\nY2v28y0WEdWd0h6/4S28lSE5nG0IigsfuIh0FIvH9vGVwBqCPm1DOEAUIQIDAQAB\\nAoGAE/ZVUY6vUfLQl46cQUj62YSW8URj+FaIjy8a2n+NDOcYV0K4HEnWZDGfmAkI\\nPuvbUDsabdAnMdYRDjjz1H7L4Y52vU+ZqD3+kJ3iUsR9Ba+R17zS6F4HVNPCzUDI\\nOpgE+z8od8+on2cppBPHMEl/Ze+CcKYLz7bLs8zje8QHZMkCRQDyuEx9WQSCf0LS\\nds+jwr7npwVlbb737oal6UKuVzKv039aLaxBpsAeMQsSdXgBq2E2ChmC8SmPuB0V\\n0mutfSBu2UapkwI9ALTwh/iFkje7O/1wjCVZn4TnLz6a4nx676rydpsRy2PrDyQ3\\naC5SWmzQezeSTs9Qmbhxm4ZTj3Co4aeL+wJEC+zqNS5ufkrqaZTU1uL2pkMajMU7\\noMrjartvP0mhf+oQU8nysLcUsWcPeDS1VL+q4xDT+A8JT7poE25nQ/rl4Qxj4GkC\\nPQCR+zoIlWOZ2VMWMBayD7P22zqvzPCMM/dnuYVdqSaqr7wgoR9JuCHChxXSiRVS\\niBntyKMM5h/laivdLL8CRGdrBwiAkVrYnghDj+9UJX9Twox3oahPqYhzxWJR7jZ4\\nipOKhw9r+YfZDNDYpVgE+g2KB75tZlOU9Hx7dXyzANnsIueT\\n-----END RSA PRIVATE KEY-----\\n"}')},237:function(e,t,n){},238:function(e,t,n){},239:function(e,t,n){},247:function(e,t,n){},252:function(e,t){},255:function(e,t){},266:function(e,t){},268:function(e,t){},295:function(e,t){},297:function(e,t){},298:function(e,t){},303:function(e,t){},305:function(e,t){},311:function(e,t){},313:function(e,t){},332:function(e,t){},344:function(e,t){},347:function(e,t){},369:function(e,t,n){},370:function(e,t,n){},372:function(e,t,n){"use strict";n.r(t);var c=n(3),o=n(8),r=n(0),a=n.n(r),s=n(106),i=n.n(s),l=(n(237),n(4)),d=(n(238),n(16)),u=(n(239),10),b=500;String.prototype.format=function(){for(var e=this,t=0;t<arguments.length;t++){var n=new RegExp("\\{"+t+"\\}","gi");e=e.replace(n,arguments[t])}return e};var j={position:"top-center",autoClose:3e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0},O=function(e,t){return"0"===t?e.normal:"1"===t?e.overDue:"2"===t?e.stopped:void 0},h=function(e,t){return"0"===t?e.available:"1"===t?e.checkedOut:"3"===t?e.overDue:e.notAvailable},f=function(e){return unescape(encodeURIComponent(e))},g="custom-loading-id",p="custom-logging-id",x=n(1);var v,m,k,S,y,I,E,C,R=function(e){return Object(r.useEffect)((function(){function t(){return(t=Object(o.a)(Object(c.a)().mark((function t(){return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("Home"),e.doc.setCallback(void 0);case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[]),Object(x.jsx)("div",{id:"home",dangerouslySetInnerHTML:{__html:e.text.homeText}})},N=(n(62),n(225)),w=n(387),D=n(79),A=n.n(D),T=n(80),_=n.n(T),L=n(54),U=n(55),P=Object(U.a)(v||(v=Object(L.a)(["\n    query AllBook{\n        books (sortBy: TITLE_ASC, limit:20000) {\n            _id\n            author\n            title\n            claim_num\n            num\n            series\n            category\n            claim\n            publisher\n            seqnum\n        }\n    }\n"]))),B=Object(U.a)(m||(m=Object(L.a)(["\n    query AllRent{\n        rents (limit:20000) {\n            _id\n            book_id\n            user_id\n            rent_date\n            return_date\n            state\n        }\n    }\n"]))),M=Object(U.a)(k||(k=Object(L.a)(["\n    query AllUser {\n        users (limit: 20000) {\n            _id\n            name\n            state\n            level\n        }\n    }"]))),H=Object(U.a)(S||(S=Object(L.a)(["\n    query FindUser($_id: String!){\n        user (query: {_id:$_id}) {\n            _id\n            name\n            state\n            level\n            encrypted_email\n            encrypted_phone\n        }\n    }"]))),K=Object(U.a)(y||(y=Object(L.a)(["\n    query findLogs($user_id: String!){\n        rentLogs (query: {user_id: $user_id}) {\n            _id\n            book_id\n            book_state\n            timestamp\n            user_id\n        }\n    }"]))),F=Object(U.a)(I||(I=Object(L.a)(["\n    query GetNotices {\n        notices (sortBy: _ID_DESC, limit:20000) {\n            _id\n            date\n            title\n        }\n    }"]))),z=Object(U.a)(E||(E=Object(L.a)(["\n    query GetContent ($_id: String!) {\n        notice (query: {_id: $_id}) {\n            _id\n            date\n            title\n            content\n        }\n    }"]))),V=Object(U.a)(C||(C=Object(L.a)(["\n    query GetServerInfo {\n        serverInfo {\n            _id\n            globalIp\n            localIp\n            port\n        }\n    }"])));var Y=function(e){var t=Object(r.useState)([]),n=Object(l.a)(t,2),a=n[0],s=n[1],i=Object(r.useState)([]),d=Object(l.a)(i,2),b=d[0],j=d[1],O=Object(r.useState)(0),h=Object(l.a)(O,2),f=h[0],g=h[1],p=Object(r.useState)(-1),v=Object(l.a)(p,2),m=v[0],k=v[1],S=Object(N.b)(F),y=S.loading,I=S.data,E=S.error,C=Object(w.a)(z,{variables:{_id:m}}),R=Object(l.a)(C,2),D=R[0],T=R[1],L=T.loading,U=T.data,P=T.error;Object(r.useEffect)((function(){function t(){return(t=Object(o.a)(Object(c.a)().mark((function t(){return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("Notice"),e.doc.setCallback(void 0);case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[]),Object(r.useEffect)((function(){console.log("Get Notice"),I&&s(I.notices)}),[I,E,y]),Object(r.useEffect)((function(){console.log("Get Content")}),[U,P,L]),Object(r.useEffect)((function(){var e=a.length;if(console.log("Page num "+f.toString()+" "),console.log(e),e>u){var t=f*u,n=Math.min(u,e-t);j(a.slice(t,t+n))}else j(a),g(0)}),[a,f]),Object(r.useEffect)((function(){}),[b]);var B=function(e){return Object(x.jsxs)("tr",{className:"",children:[Object(x.jsxs)("td",{className:"",children:[" ",e.date," "]}),Object(x.jsxs)("td",{className:"noticeEntry",colSpan:"2",onClick:function(){return t=e._id,console.log("selected "+t.toString()),k(m===t?-1:t),void D();var t},children:[" ",e.title]})]},e._id)};return Object(x.jsxs)("div",{id:"notice",children:[Object(x.jsx)("div",{id:"title",children:Object(x.jsx)("h2",{children:e.text.notice})}),m>0&&U&&Object(x.jsx)("div",{id:"noticeContent",children:Object(x.jsx)("table",{className:"content",children:Object(x.jsxs)("tbody",{children:[B(U.notice),Object(x.jsx)("tr",{children:Object(x.jsx)("td",{className:"content",colSpan:"3",children:U.notice.content})})]})})}),Object(x.jsx)("div",{id:"noticeList",children:Object(x.jsx)("table",{children:Object(x.jsx)("tbody",{children:b.length>0&&b.map((function(e){return B(e)}))})})}),a.length>u&&Object(x.jsxs)("div",{id:"pageControl",children:[Object(x.jsx)("div",{className:"page",id:"page",children:Object(x.jsx)(A.a,{fontSize:"large",sx:{color:0===f?"#ffffff":"#404040"},onClick:function(){f>0&&g(f-1)}})}),Object(x.jsx)("div",{className:"pageNum",id:"pageNum",children:f+1}),Object(x.jsx)("div",{className:"page",id:"page",children:Object(x.jsx)(_.a,{fontSize:"large",sx:{color:a.length<=(f+1)*u?"#ffffff":"#404040"},onClick:function(){a.length>(f+1)*u&&g(f+1)}})})]})]})},q=n(26),G=n(396),Q=n(10),W=n(392);var Z=function(){console.log("Do nothing...")};var J=function(e){var t=Object(r.useState)([]),n=Object(l.a)(t,2),c=n[0],o=n[1],a=Object(r.useState)(0),s=Object(l.a)(a,2),i=s[0],d=s[1],b=Object(r.useState)([]),j=Object(l.a)(b,2),O=j[0],h=j[1];return Object(r.useEffect)((function(){console.log("Init List View")}),[]),Object(r.useEffect)((function(){console.log("Set Item List"),o(e.list)}),[e.list]),Object(r.useEffect)((function(){e.showCallback&&(console.log("Set show callback"),Z=e.showCallback)}),[e.showCallback]),Object(r.useEffect)((function(){var e=c.length;if(console.log("Page num "+i.toString()),e>u){var t=i*u,n=Math.min(u,e-t);h(c.slice(t,t+n))}else h(c)}),[c,i]),Object(x.jsxs)("div",{id:"listView",children:[Z(O),c&&c.length>u&&Object(x.jsxs)("div",{id:"pageControl",children:[Object(x.jsx)("div",{className:"page",id:"page",children:Object(x.jsx)(A.a,{fontSize:"large",sx:{color:0===i?"#ffffff":"#404040"},onClick:function(){console.log("Prev"),i>0&&d(i-1)}})}),Object(x.jsx)("div",{className:"pageNum",id:"pageNum",children:i+1}),Object(x.jsx)("div",{className:"page",id:"page",children:Object(x.jsx)(_.a,{fontSize:"large",sx:{color:c.length<=(i+1)*u?"#ffffff":"#404040"},onClick:function(){console.log("Next"),c.length>(i+1)*u&&d(i+1)}})})]})]})},X=!1;var $=function(e){var t=Object(r.useState)(""),n=Object(l.a)(t,2),a=n[0],s=n[1],i=Object(G.a)(a,50),d=Object(l.a)(i,1)[0],u=Object(r.useState)([]),j=Object(l.a)(u,2),O=j[0],g=j[1],p=Object(r.useState)([]),v=Object(l.a)(p,2),m=(v[0],v[1],Object(r.useState)(0)),k=Object(l.a)(m,2),S=(k[0],k[1]),y=Object(r.useRef)("0"),I=Object(r.useState)([]),E=Object(l.a)(I,2),C=E[0],R=E[1],N=Object(r.useState)([]),w=Object(l.a)(N,2),D=w[0],A=w[1],T=Object(Q.o)().id;function _(){return L.apply(this,arguments)}function L(){return(L=Object(o.a)(Object(c.a)().mark((function t(){var n,o,r,a,s,i,l;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(console.log("All data loaded "+X),X=!0,n=[],o=e.doc.rent,r=0;r<o.length;r++)n.push({code:o[r].book_id,retDate:o[r].return_date,state:o[r].state});for(i in A(n),a=[],s=e.doc.book)l=s[i],a.push({code:l._id,name:l.title,num:l.num,author:l.author,claim:l.claim,claim_num:l.claim_num,totalName:l.series,category:l.publisher,publish:l.publisher});console.log("Load"),console.log(s.length),R(a);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}Object(r.useEffect)((function(){function t(){return(t=Object(o.a)(Object(c.a)().mark((function t(){return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.doc.isOpen()?_():e.doc.setCallback(_),console.log("BOOK ID: "+T);case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[]),Object(r.useEffect)((function(){console.log("Updated id: "+T),s(T||"")}),[T]),Object(r.useEffect)((function(){function t(e){return n.apply(this,arguments)}function n(){return(n=Object(o.a)(Object(c.a)().mark((function t(n){var o,r,a,s,i,l,d,u,j,O,g,p,x,v,m,k,S,y,I,E;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=[],!e.doc.serverAvailable){t.next=16;break}return console.log(f(n)),console.log(btoa(f(n))),r="https://"+e.doc.serverInfo.localIp+":"+e.doc.serverInfo.port+"/book",a={params:{book:btoa(f(n)),metch:!1}},console.log(a),t.next=9,W.a.get(r,a);case 9:for(s=t.sent,console.log(s),i=s.data.return,l="",d=0;d<i.length;d++)({}),u=i[d],j="".concat(u.BOOKNAME," ").concat(u.CLAIMNUM),1!==(O=u._STATE)&&3!==O||(l=e.text.returnDate+" "+u._RETURN),g={index:d,text:j,name:u.BOOKNAME,code:u.BARCODE,rent:h(e.text,u._STATE.toString()),retDate:l,author:u.AUTHOR,totalName:u.TOTAL_NAME,claim_num:u.CLAMENUM,publish:u.PUBLISH,claim:u.CLAIM},o.push(g);t.next=50;break;case 16:p=0;case 17:if(!(p<C.length)){t.next=50;break}if(x=C[p],!(o.length>=b)){t.next=21;break}return t.abrupt("break",50);case 21:if(!(x.name&&x.name.toString().includes(n)||x.code===n)){t.next=47;break}v="".concat(x.name," ").concat(x.claim_num),e.text.available,m="",k="0",S=Object(q.a)(D),t.prev=27,S.s();case 29:if((y=S.n()).done){t.next=37;break}if((I=y.value).code!==x.code){t.next=35;break}return"1"!==(k=I.state)&&"3"!==k||(m=e.text.returnDate+" "+I.retDate),t.abrupt("break",37);case 35:t.next=29;break;case 37:t.next=42;break;case 39:t.prev=39,t.t0=t.catch(27),S.e(t.t0);case 42:return t.prev=42,S.f(),t.finish(42);case 45:E={index:p,text:v,name:x.name,code:x.code.toString(),rent:h(e.text,k),retDate:m,author:x.author,totalName:x.totalName,claim_num:x.claim_num,publish:x.publish,claim:x.claim},o.push(E);case 47:p++,t.next=17;break;case 50:return o.sort((function(e,t){return e.text>t.text})),t.abrupt("return",o);case 52:case"end":return t.stop()}}),t,null,[[27,39,42,45]])})))).apply(this,arguments)}function r(){return(r=Object(o.a)(Object(c.a)().mark((function e(){var n;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!d){e.next=8;break}return e.next=3,t(d);case 3:(n=e.sent).length>0?g(n):g([]),1===n.length&&(y.current=n[0].code),e.next=9;break;case 8:g([]);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){r.apply(this,arguments)}()}),[d,C,D,e]);var U=function(){var e=Object(o.a)(Object(c.a)().mark((function e(t){return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Prev "+y.current),-1===y.current||y.current!==t?(console.log("Select "+t),S(t),y.current=t):(console.log("Deselect "+t),S(-1),y.current=-1);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P=function(e){var t=e.code!==y.current,n=t?"searchResult":"selectedSearchResult";return Object(x.jsxs)("div",{children:[Object(x.jsx)("div",{id:n,onClick:Object(o.a)(Object(c.a)().mark((function t(){return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,U(e.code);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))),children:Object(x.jsx)("table",{children:Object(x.jsx)("tbody",{children:Object(x.jsxs)("tr",{className:"searchTr",children:[Object(x.jsxs)("td",{className:"searchTitle",children:[" ",e.text]}),Object(x.jsxs)("td",{className:"searchRent",children:[" ",e.rent," "]})]})})})}),!t&&Object(x.jsx)("div",{children:Object(x.jsx)("table",{children:Object(x.jsxs)("tbody",{children:[Object(x.jsxs)("tr",{children:[Object(x.jsxs)("td",{children:[e.author," "]}),Object(x.jsxs)("td",{colSpan:"2",rowSpan:"2",children:[e.totalName," ",Object(x.jsx)("b",{children:e.name})," ",e.claim_num," "]})]}),Object(x.jsx)("tr",{children:Object(x.jsxs)("td",{children:[e.code," "]})}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{children:e.publish}),Object(x.jsxs)("td",{colSpan:e.retDate.length>0?"1":"2",children:[e.claim," "]}),e.retDate.length>0&&Object(x.jsx)("td",{children:e.retDate})]})]})})})]},e.code)};return Object(x.jsxs)("div",{id:"search",children:[Object(x.jsx)("div",{id:"title",children:Object(x.jsxs)("h2",{children:[" ",e.text.bookSearch," "]})}),Object(x.jsx)("div",{id:"searchContents",children:Object(x.jsx)("input",{id:"searchInput",placeholder:e.text.searchBook,value:a,onChange:function(e){s(e.target.value)}})}),Object(x.jsx)(J,{list:O,showCallback:function(e){return e.map((function(e){return P(e)}))}})]})};n(247);var ee=n(27),te={LoggedOut:0,LoggingIn:1,LoggedIn:2};var ne=function(e){var t=Object(r.useState)(""),n=Object(l.a)(t,2),s=n[0],i=n[1],u=Object(r.useState)(""),b=Object(l.a)(u,2),O=b[0],h=b[1],f=Object(r.useState)([]),g=Object(l.a)(f,2),v=g[0],m=g[1],k=Object(r.useState)(!1),S=Object(l.a)(k,2),y=S[0],I=S[1],E=Object(r.useState)(""),C=Object(l.a)(E,2),R=C[0],N=C[1],D=Object(r.useState)(te.LoggedOut),A=Object(l.a)(D,2),T=A[0],_=A[1],L=Object(r.useState)([]),U=Object(l.a)(L,2),P=U[0],B=U[1],M=Object(r.useState)(!1),F=Object(l.a)(M,2),z=F[0],V=F[1],Y=Object(w.a)(H,{variables:{_id:R}}),q=Object(l.a)(Y,2),G=q[0],Q=q[1].data,W=Object(w.a)(K,{variables:{user_id:R}}),Z=Object(l.a)(W,2),X=Z[0],$=Z[1].data,ne=Object(r.useState)(""),ce=Object(l.a)(ne,2),oe=ce[0],re=ce[1],ae=Object(r.useState)(""),se=Object(l.a)(ae,2),ie=se[0],le=se[1];function de(){return ue.apply(this,arguments)}function ue(){return(ue=Object(o.a)(Object(c.a)().mark((function t(){var n;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("All data loaded "+y),!e.doc.logged){t.next=10;break}return _(te.LoggedIn),n=e.doc.userInfo._id,N(n),m(e.doc.getRent(n)),t.next=8,X();case 8:t.next=13;break;case 10:_(te.LoggedOut),N(""),h("");case 13:console.log("Set title "+e.doc.logged),e.doc.logged?e.doc.adminMode?le(e.text.userSearch):le(e.text.checkOut):le(e.text.logIn),console.log("Done"),I(!0);case 17:case"end":return t.stop()}}),t)})))).apply(this,arguments)}Object(r.useEffect)((function(){function t(){return(t=Object(o.a)(Object(c.a)().mark((function t(){var n,o;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.doc.isOpen()?de():e.doc.setCallback(de),console.log("======================================="),console.log("CheckOutStatus initialize"),"autoLogin"in e.context.cookie&&(n="true"===e.context.cookie.autoLogin,V(n)),o=new Date,2,o.setTime(o.getTime()+1728e5),re(o.toGMTString());case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[]),Object(r.useEffect)((function(){console.log("User data updated "),de()}),[e.doc.logged]),Object(r.useEffect)((function(){console.log("User data updated "),Oe()}),[Q]),Object(r.useEffect)((function(){var t=[];if($&&e.doc.bookReady&&e.doc.rentReady){console.log("History updated ");for(var n=0;n<$.rentLogs.length;n++){var c=$.rentLogs[n];if("0"===c.book_state||"1"===c.book_state){var o=c.book_id,r=c.timestamp.split(" ")[0].replace("-","/",2).replace("-","/");t.push({id:o,title:e.doc.book[o].title,date:r,state:c.book_state})}}t.sort((function(e,t){return e.date>t.date}));for(var a=[],s=0;s<t.length-1;s++)if("1"===t[s].state)for(var i=t[s],l=i.id,d=s+1;d<t.length;d++)if("0"===t[d].state&&l===t[d].id){a.push({id:i.id,title:i.title,rentDate:i.date,retDate:t[d].date});break}console.log("Set history"),B(a)}}),[$,e.doc.bookReady,e.doc.rentReady]);var be=function(t){return Object(x.jsx)("div",{children:Object(x.jsx)("table",{children:Object(x.jsxs)("tbody",{children:[Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{id:"id",children:e.text.id}),Object(x.jsx)("th",{id:"rentDate",children:e.text.rentDate}),Object(x.jsx)("th",{id:"returnDate",children:e.text.returnDate})]},"ID"),t.map((function(e,t){return function(e,t){var n=e.id,c=e.rentDate,o=e.retDate,r=e.title,s=t.toString();return Object(x.jsxs)(a.a.Fragment,{children:[Object(x.jsxs)("tr",{className:"bookData",children:[Object(x.jsx)("td",{className:"bookData",children:Object(x.jsx)(ee.b,{to:"/search/"+n,children:n})}),Object(x.jsx)("td",{className:"bookData",children:c}),Object(x.jsx)("td",{className:"bookData",children:o})]},s),Object(x.jsx)("tr",{className:"bookName",children:Object(x.jsx)("td",{colSpan:"3",className:"bookName",children:r})},s+"Title")]},s+"Fragment")}(e,t)})),0===t.length&&Object(x.jsx)("tr",{children:Object(x.jsx)("td",{colSpan:"3",children:e.text.noEntry})},"None")]})})})},je=function(){var e=Object(o.a)(Object(c.a)().mark((function e(){return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _(te.LoggingIn),N(s.toUpperCase()),e.next=4,G();case 4:return e.next=6,X();case 6:console.log("Log In"),Oe();case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Oe=function(){if(Q&&T!==te.LoggedOut){console.log(d.c.isActive(p));var t,n=j;e.context.checkLogIn(Q,O)?(e.doc.logIn(Q.user),m(e.doc.getRent(R)),_(te.LoggedIn),n.type=d.c.TYPE.SUCCESS,t=e.text.logInSucceed,document.cookie="user_id="+R+"; expires="+oe+";"):(n.type=d.c.TYPE.ERROR,t=e.text.logInFail),n.render=t,n.autoClose=3e3,n.toastId=p,d.c.isActive(p)?(console.log("update toast"),d.c.update(p,n)):(console.log("New toast"),d.c.info(t,n))}};return Object(x.jsxs)("div",{id:"checkOut",children:[Object(x.jsx)("div",{id:"title",children:Object(x.jsx)("h2",{children:ie})}),Object(x.jsxs)("div",{id:"checkOutInput",hidden:!(T!==te.LoggedIn),children:[Object(x.jsx)("input",{type:"text",id:"searchInput",placeholder:e.text.idHolder,value:s,disabled:!y,onInput:function(e){i(e.target.value)}}),Object(x.jsx)("input",{type:"password",id:"searchPassword",placeholder:e.text.pwHolder,value:O,disabled:!y,onInput:function(e){h(e.target.value)}}),Object(x.jsxs)("div",{id:"autoLogin",children:[Object(x.jsx)("input",{type:"checkbox",id:"autoLoginButton",checked:z,onChange:function(){return function(){console.log("Toggle autoLogin");var e="autoLogin="+(z?"false":"true")+"; expires="+oe+";";console.log(e),document.cookie=e,V(!z)}()}}),Object(x.jsx)("label",{children:e.text.autoLogin})]}),Object(x.jsxs)("button",{id:"logIn",onClick:Object(o.a)(Object(c.a)().mark((function e(){return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",je());case 1:case"end":return e.stop()}}),e)}))),children:[" ",e.text.logIn," "]})]}),Object(x.jsxs)("div",{id:"checkOutResult",hidden:!(T===te.LoggedIn),children:[Object(x.jsx)("div",{children:be(v)}),Object(x.jsx)("div",{id:"name",children:e.text.history}),Object(x.jsx)(J,{list:P,showCallback:function(e){return be(e)}})]})]})},ce=n(116),oe=n.n(ce),re={LoggedOut:0,LoggingIn:1,LoggedIn:2,LoggingOut:3};var ae=function(e){var t=Object(r.useState)(""),n=Object(l.a)(t,2),a=n[0],s=n[1],i=Object(r.useState)(""),u=Object(l.a)(i,2),b=u[0],h=u[1],f=Object(G.a)(b,50),v=Object(l.a)(f,1)[0],m=Object(r.useState)(""),k=Object(l.a)(m,2),S=k[0],y=k[1],I=Object(r.useState)(re.LoggedOut),E=Object(l.a)(I,2),C=E[0],R=E[1],N=Object(r.useState)({}),w=Object(l.a)(N,2),D=w[0],A=w[1],T=Object(r.useState)({}),_=Object(l.a)(T,2),L=_[0],U=_[1],P=Object(r.useState)(!1),B=Object(l.a)(P,2),M=B[0],H=B[1],K=Object(r.useState)({}),F=Object(l.a)(K,2),z=F[0],V=F[1],Y=Object(r.useState)(""),q=Object(l.a)(Y,2),Q=q[0],Z=q[1];Object(r.useEffect)((function(){function t(){return(t=Object(o.a)(Object(c.a)().mark((function e(){return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("======================================="),console.log("CheckOut initialize");case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var n=setInterval(Object(o.a)(Object(c.a)().mark((function t(){var o,r,a;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.doc.serverInfo.localIp,r=e.doc.serverInfo.port,o.length>0&&r>0&&(a="https://"+o+":"+r+"/scanBarcode",W.a.get(a).then((function(e){var t=e.data.scan;t&&(console.log(t),Z(t))}))),t.abrupt("return",(function(){return clearInterval(n)}));case 4:case"end":return t.stop()}}),t)}))),1e3);!function(){t.apply(this,arguments)}()}),[]),Object(r.useEffect)((function(){console.log("User data updated "),console.log(d.c.isActive(p));var t,n=j,c=!1;"USER_CODE"in D&&C!==re.LoggedIn?(R(re.LoggedIn),n.type=d.c.TYPE.SUCCESS,t=e.text.logInSucceed,c=!0):"USER_CODE"in D||(R(re.LoggedOut),C===re.LoggingIn&&(n.type=d.c.TYPE.ERROR,t=e.text.logInFail,c=!0)),c&&V({id:g,text:t,type:n.type})}),[D]),Object(r.useEffect)((function(){console.log("book updated "),"BARCODE"in L?0===L._STATE?H(!0):(V({id:g,text:e.text.RENTED,type:d.c.TYPE.ERROR}),document.getElementById("barcodeScan").value=null,H(!1)):(H(!1),Z(""))}),[L]),Object(r.useEffect)((function(){if("text"in z){d.c.dismiss(),console.log("Notification "+z.text);var e=j;e.type=z.type,e.autoClose=3e3,d.c.info(z.text,e)}}),[z]),Object(r.useEffect)((function(){C!==re.LoggedIn&&Z(a)}),[a]);var J=function(){var t=Object(o.a)(Object(c.a)().mark((function t(n){var o,r,a,s;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o="https://"+e.doc.serverInfo.localIp+":"+e.doc.serverInfo.port+"/user?user="+n,r={params:{user:n,data:"nothing"}},console.log(r),t.next=5,W.a.get(o,btoa(JSON.stringify(r)));case 5:a=t.sent,s=a.data.return,A(s),console.log(s);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),X=function(){var e=Object(o.a)(Object(c.a)().mark((function e(){var t;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("LOGIN"),console.log(a),0!==a.length){e.next=4;break}return e.abrupt("return");case 4:R(re.LoggingIn),t=a.toUpperCase(),y(t),J(t);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$=function(){var e=Object(o.a)(Object(c.a)().mark((function e(){return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Log Out"),A({}),s(""),U({}),Z(""),document.getElementById("barcodeScan").value=null;case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function ee(t){if(console.log("Image Captured"),t.target.files&&t.target.files.length>0){var n=t.target.files[0];console.log(n),console.log(n.type);var c="https://"+e.doc.serverInfo.localIp+":"+e.doc.serverInfo.port+"/uploadImage";console.log(c),V({id:g,text:e.text.loading,type:d.c.TYPE.INFO}),function(e){return new Promise((function(t,n){var c=new FileReader;c.readAsDataURL(e),c.onload=function(){return t(c.result)},c.onerror=function(e){return n(e)}}))}(n).then((function(t){Object(W.a)({method:"post",mode:"no-cors",crossDomain:"true",url:c,headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json","Access-Control-Allow-Methods":"GET, PUT, POST, DELETE, OPTIONS"},withCredentials:!1,credentials:"same-origin",data:{image:t}}).then((function(t){var n=t.data.return;console.log(t),console.log(n),"BOOKNAME"in n?(U(n),V({id:g,text:e.text.succeededToOpen,type:d.c.TYPE.SUCCESS})):(console.log("Failed"),V({id:g,text:e.text.INVALID_BOOK,type:d.c.TYPE.ERROR}),U({}),Z(""))}))}))}}return Object(r.useEffect)((function(){if(b.length>0){var t="HK"+b;console.log("Search book "+t);var n="https://"+e.doc.serverInfo.localIp+":"+e.doc.serverInfo.port+"/book",c={params:{book:t,match:!0}};console.log(c),W.a.get(n,c).then((function(e){var t=e.data.return;console.log(t),"BOOKNAME"in t&&U(t)}))}}),[v]),Object(r.useEffect)((function(){if(console.log("Barcode: "+Q),0!=Q.length)if(C!==re.LoggedIn)s(Q);else{var t=Q;console.log("Search book "+t);var n="https://"+e.doc.serverInfo.localIp+":"+e.doc.serverInfo.port+"/book",c={params:{book:t,match:!0}};console.log(c),W.a.get(n,c).then((function(e){var t=e.data.return;console.log(t),"BOOKNAME"in t&&U(t)}))}}),[Q]),Object(x.jsxs)("div",{id:"checkOut",children:[Object(x.jsx)("div",{id:"title",children:Object(x.jsx)("h2",{children:e.text.checkOut})}),Object(x.jsxs)("div",{id:"checkOutInput",hidden:C===re.LoggedIn,children:[Object(x.jsx)("input",{type:"text",id:"searchInput",placeholder:e.text.idHolder,value:a,onInput:function(e){s(e.target.value)}}),Object(x.jsxs)("button",{id:"logIn",onClick:Object(o.a)(Object(c.a)().mark((function e(){return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",X());case 1:case"end":return e.stop()}}),e)}))),children:[" ",e.text.logIn," "]})]}),Object(x.jsxs)("div",{id:"checkOutResult",hidden:C!==re.LoggedIn,children:[D.USER_CODE&&Object(x.jsxs)("div",{id:"userInfo",children:[Object(x.jsx)("div",{id:"userItem",children:D.USER_CODE+" : "+D.USER_NAME+e.text.nameSuffix}),Object(x.jsxs)("div",{id:"userItem",children:[" ",O(e.text,D.USER_STATE)," "]}),Object(x.jsxs)("div",{id:"userItem",children:[" ",D._RENT.length+" "+e.text.rentSuffix," "]})]}),Object(x.jsxs)("div",{id:"bookInput",hidden:M,children:[Object(x.jsxs)("label",{id:"barcodeScan",hidden:!0,children:[Object(x.jsx)(oe.a,{fontSize:"large",sx:{color:"#404040"}}),Object(x.jsx)("span",{children:Object(x.jsx)("input",{type:"file",id:"barcodeScanInput",accept:"image/*",capture:"environment",onChange:function(e){return ee(e)}})})]}),Object(x.jsxs)("label",{id:"manualInput",children:[Object(x.jsx)("div",{id:"hkPrefix",children:"HK"}),Object(x.jsx)("input",{inputMode:"numeric",pattern:"[0-9]*",type:"text",id:"searchInput",placeholder:e.text.bookHolder,onInput:function(e){h(e.target.value)}})]})]}),Object(x.jsxs)("div",{id:"checkRent",hidden:!M,children:[Object(x.jsxs)("div",{id:"bookName",children:[" ",e.text.confirmRent," "]}),Object(x.jsxs)("div",{id:"bookName",children:[" ",L.AUTHOR+": "+L.BOOKNAME," "]}),Object(x.jsx)("button",{id:"confirm",onClick:function(){return function(){console.log("Confirmed"),H(!1),console.log(L),document.getElementById("barcodeScan").value=null;var t="https://"+e.doc.serverInfo.localIp+":"+e.doc.serverInfo.port+"/checkOut";Object(W.a)({method:"post",mode:"no-cors",crossDomain:"true",url:t,headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json","Access-Control-Allow-Methods":"GET, PUT, POST, DELETE, OPTIONS"},withCredentials:!1,credentials:"same-origin",data:{book:L.BARCODE,user:S}}).then((function(t){var n,c=t.data.return;console.log("Rent confirmed"),console.log(c),"SUCCESS"===c?V({id:g,text:e.text.rentSucceed,type:d.c.TYPE.SUCCESS}):(n=c in e.text?e.text[c]:e.text.NOT_AVAILABLE,console.log(n),V({id:g,text:n,type:d.c.TYPE.ERROR})),U({}),Z(""),J(S)}))}()},children:" Confirm "}),Object(x.jsx)("button",{id:"cancel",onClick:function(){return console.log("Cancelled"),H(!1),document.getElementById("barcodeScan").value=null,U({}),void Z("")},children:" Cancel "})]}),Object(x.jsx)("div",{children:Object(x.jsxs)("button",{id:"logOutButton",onClick:function(){return $()},children:[" ",e.text.logOut," "]})})]})]})},se={LoggedOut:0,LoggingIn:1,LoggedIn:2};var ie=function(e){var t=Object(r.useState)(""),n=Object(l.a)(t,2),a=n[0],s=n[1],i=Object(G.a)(a,50),u=Object(l.a)(i,1)[0],b=Object(r.useState)(!1),O=Object(l.a)(b,2),h=(O[0],O[1],Object(r.useState)("")),f=Object(l.a)(h,2),p=f[0],v=(f[1],Object(r.useState)(se.LoggedOut)),m=Object(l.a)(v,2),k=(m[0],m[1],Object(r.useState)([])),S=Object(l.a)(k,2),y=(S[0],S[1]),I=Object(r.useState)(!1),E=Object(l.a)(I,2),C=(E[0],E[1],Object(w.a)(H,{variables:{_id:p}})),R=Object(l.a)(C,2),N=(R[0],R[1].data,Object(w.a)(K,{variables:{user_id:p}})),D=Object(l.a)(N,2),A=(D[0],D[1].data),T=Object(r.useState)(""),_=Object(l.a)(T,2),L=(_[0],_[1],Object(r.useState)({})),U=Object(l.a)(L,2),P=U[0],B=U[1],M=Object(r.useState)(!1),F=Object(l.a)(M,2),z=F[0],V=F[1],Y=Object(r.useState)({}),q=Object(l.a)(Y,2),Q=q[0],Z=q[1],J=Object(r.useState)(""),X=Object(l.a)(J,2),$=X[0],ee=X[1];function te(t){if(console.log("Image Captured"),t.target.files&&t.target.files.length>0){var n=t.target.files[0];console.log(n),console.log(n.type);var c="https://"+e.doc.serverInfo.localIp+":"+e.doc.serverInfo.port+"/uploadImage";Z({id:g,text:e.text.loading,type:d.c.TYPE.INFO}),function(e){return new Promise((function(t,n){var c=new FileReader;c.readAsDataURL(e),c.onload=function(){return t(c.result)},c.onerror=function(e){return n(e)}}))}(n).then((function(t){Object(W.a)({method:"post",mode:"no-cors",crossDomain:"true",url:c,headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json","Access-Control-Allow-Methods":"GET, PUT, POST, DELETE, OPTIONS"},withCredentials:!1,credentials:"same-origin",data:{image:t}}).then((function(t){var n=t.data.return;console.log(n),"BOOKNAME"in n?(B(n),Z({id:g,text:e.text.succeededToOpen,type:d.c.TYPE.SUCCESS})):(Z({id:g,text:e.text.INVALID_BOOK,type:d.c.TYPE.ERROR}),B({}),ee(""))}))}))}}return Object(r.useEffect)((function(){function t(){return(t=Object(o.a)(Object(c.a)().mark((function t(){return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.doc.setCallback(void 0),console.log("======================================="),console.log("Return initialize");case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var n=setInterval(Object(o.a)(Object(c.a)().mark((function t(){var o,r,a;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.doc.serverInfo.localIp,r=e.doc.serverInfo.port,o.length>0&&r>0&&(a="https://"+o+":"+r+"/scanBarcode",W.a.get(a).then((function(e){var t=e.data.scan;t&&(console.log($+" -> "+t),ee(t))}))),t.abrupt("return",(function(){return clearInterval(n)}));case 4:case"end":return t.stop()}}),t)}))),1e3);!function(){t.apply(this,arguments)}()}),[]),Object(r.useEffect)((function(){var t=[];if(A&&e.doc.bookReady&&e.doc.rentReady){console.log("History updated ");for(var n=0;n<A.rentLogs.length;n++){var c=A.rentLogs[n];if("0"===c.book_state||"1"===c.book_state){var o=c.book_id,r=c.timestamp.split(" ")[0].replace("-","/",2).replace("-","/");t.push({id:o,title:e.doc.book[o].title,date:r,state:c.book_state})}}t.sort((function(e,t){return e.date>t.date}));for(var a=[],s=0;s<t.length-1;s++)if("1"===t[s].state)for(var i=t[s],l=i.id,d=s+1;d<t.length;d++)if("0"===t[d].state&&l===t[d].id){a.push({id:i.id,title:i.title,rentDate:i.date,retDate:t[d].date});break}console.log("Set history"),y(a)}}),[A,e.doc.bookReady,e.doc.rentReady]),Object(r.useEffect)((function(){if(a.length>0){var t="HK"+a;console.log("Search book "+t);var n="https://"+e.doc.serverInfo.localIp+":"+e.doc.serverInfo.port+"/book",c={params:{book:t,match:!0}};console.log(c),W.a.get(n,c).then((function(e){var t=e.data.return;console.log(t),"BOOKNAME"in t&&B(t)}))}}),[u]),Object(r.useEffect)((function(){if(console.log($),$.length>0){var t=$;console.log("Search book "+t);var n="https://"+e.doc.serverInfo.localIp+":"+e.doc.serverInfo.port+"/book",c={params:{book:t,match:!0}};console.log(c),W.a.get(n,c).then((function(e){var t=e.data.return;console.log(t),"BOOKNAME"in t&&B(t)}))}}),[$]),Object(r.useEffect)((function(){console.log("book updated "),"BARCODE"in P?1==P._STATE||3==P._STATE?V(!0):(console.log("Not rented"),Z({id:g,text:e.text.NOT_RENTED,type:d.c.TYPE.ERROR}),document.getElementById("barcodeScan").value=null,V(!1),ee("")):V(!1)}),[P]),Object(r.useEffect)((function(){if(!(!1 in Q)){d.c.dismiss();var e=j;Q.text;e.type=Q.type,e.autoClose=3e3,d.c.info(Q.text,e)}}),[Q]),Object(x.jsxs)("div",{id:"checkOut",children:[Object(x.jsx)("div",{id:"title",children:Object(x.jsx)("h2",{children:e.text.return})}),Object(x.jsxs)("div",{id:"checkOutResult",children:[Object(x.jsxs)("div",{id:"bookInput",hidden:z,children:[Object(x.jsxs)("label",{id:"barcodeScan",hidden:!0,children:[Object(x.jsx)(oe.a,{fontSize:"large",sx:{color:"#404040"}}),Object(x.jsx)("span",{children:Object(x.jsx)("input",{type:"file",id:"barcodeScanInput",accept:"image/*",capture:"environment",onChange:function(e){return te(e)}})})]}),Object(x.jsxs)("label",{id:"manualInput",children:[Object(x.jsx)("div",{id:"hkPrefix",children:"HK"}),Object(x.jsx)("input",{inputMode:"numeric",pattern:"\\d*",type:"text",id:"searchInput",placeholder:e.text.bookHolder,onInput:function(e){s(e.target.value)}})]})]}),Object(x.jsxs)("div",{id:"checkReturn",hidden:!z,children:[Object(x.jsxs)("div",{id:"bookName",children:[" ",e.text.confirmReturn," "]}),Object(x.jsxs)("div",{id:"bookName",children:[" ",P.AUTHOR+":"+P.BOOKNAME," "]}),Object(x.jsx)("button",{id:"confirm",onClick:function(){return function(){console.log("Confirmed"),V(!1),console.log(P);var t="https://"+e.doc.serverInfo.localIp+":"+e.doc.serverInfo.port+"/return";Object(W.a)({method:"post",mode:"no-cors",crossDomain:"true",url:t,headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json","Access-Control-Allow-Methods":"GET, PUT, POST, DELETE, OPTIONS"},withCredentials:!1,credentials:"same-origin",data:{book:P.BARCODE}}).then((function(t){var n,c=t.data.return;console.log(c),"SUCCESS"==c?Z({id:g,text:e.text.returnSucceed,type:d.c.TYPE.SUCCESS}):(n=c in e.text?e.text[c]:e.text.NOT_AVAILABLE,console.log(n),Z({id:g,text:n,type:d.c.TYPE.ERROR})),B({}),ee("")}))}()},children:" Confirm "}),Object(x.jsx)("button",{id:"cancel",onClick:function(){return console.log("Cancelled"),V(!1),B({}),void ee("")},children:" Cancel "})]})]})]})};var le=function(e){var t=Object(r.useState)(""),n=Object(l.a)(t,2),s=n[0],i=n[1],u=Object(G.a)(s,50),h=Object(l.a)(u,1)[0],f=Object(r.useState)([]),g=Object(l.a)(f,2),p=g[0],v=g[1],m=Object(r.useState)(!1),k=Object(l.a)(m,2),S=k[0],y=k[1],I=Object(r.useState)(""),E=Object(l.a)(I,2),C=E[0],R=(E[1],Object(r.useState)([])),D=Object(l.a)(R,2),A=(D[0],D[1]),T=Object(N.b)(M),_=T.loading,L=T.data,U=T.error,P=Object(w.a)(H,{variables:{_id:C}}),B=Object(l.a)(P,2),F=(B[0],B[1].data),z=Object(w.a)(K,{variables:{user_id:C}}),V=Object(l.a)(z,2),Y=(V[0],V[1].data),q=Object(r.useState)({}),Q=Object(l.a)(q,2),W=Q[0],Z=Q[1],X=Object(r.useState)(""),$=Object(l.a)(X,2),te=($[0],$[1],Object(r.useState)(0)),ne=Object(l.a)(te,2),ce=(ne[0],ne[1]),oe=Object(r.useState)(0),re=Object(l.a)(oe,2),ae=(re[0],re[1]),se=Object(r.useRef)("0"),ie=Object(r.useState)([]),le=Object(l.a)(ie,2);function de(){return ue.apply(this,arguments)}function ue(){return ue=Object(o.a)(Object(c.a)().mark((function t(){var n,o,r=arguments;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=!(r.length>0&&void 0!==r[0])||r[0],console.log("All data loaded "+S),n&&((o=j).type=d.c.TYPE.SUCCESS,o.render=e.text.succeededToOpen,o.autoClose=3e3,o.toastId="",d.c.info(e.text.succeededToOpen,o)),console.log("Set title "+e.logged),console.log("Done"),y(!0);case 6:case"end":return t.stop()}}),t)}))),ue.apply(this,arguments)}le[0],le[1],Object(r.useEffect)((function(){function t(){return(t=Object(o.a)(Object(c.a)().mark((function t(){return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.doc.isOpen()?de(!1):e.doc.setCallback(de),console.log("======================================="),console.log("UserSearch initialize");case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[]),Object(r.useEffect)((function(){console.log("User data updated "),de(!1)}),[e.logged]),Object(r.useEffect)((function(){console.log("User data updated ")}),[F]),Object(r.useEffect)((function(){if(console.log("User list loaded"),console.log(U),console.log(_),L){var t=[];console.log("User list available");e.text.normal,e.text.overDue,e.text.stopped;for(var n=0;n<L.users.length;n++){var c=L.users[n],o={id:c._id,name:c.name,level:c.level,state:O(e.text,c.state)};t.push(o)}console.log(t),e.doc.setUser(t),console.log(e.doc.getUser()),Z(e.doc.getUser())}}),[L,_,U]),Object(r.useEffect)((function(){var t=[];if(Y&&e.doc.bookReady&&e.doc.rentReady){console.log("History updated ");for(var n=0;n<Y.rentLogs.length;n++){var c=Y.rentLogs[n];if("0"===c.book_state||"1"===c.book_state){var o=c.book_id,r=c.timestamp.split(" ")[0].replace("-","/",2).replace("-","/");t.push({id:o,title:e.doc.book[o].title,date:r,state:c.book_state})}}t.sort((function(e,t){return e.date>t.date}));for(var a=[],s=0;s<t.length-1;s++)if("1"===t[s].state)for(var i=t[s],l=i.id,d=s+1;d<t.length;d++)if("0"===t[d].state&&l===t[d].id){a.push({id:i.id,title:i.title,rentDate:i.date,retDate:t[d].date});break}console.log("Set history"),A(a)}}),[Y,e.doc.bookReady,e.doc.rentReady]);var be=function(){var e=Object(o.a)(Object(c.a)().mark((function e(t){return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:-1===se.current||se.current!==t?(console.log("Select "+t),ae(t),se.current=t):(console.log("Deselect "+t),ae(-1),se.current=-1);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),je=function(t){return Object(x.jsxs)("div",{children:[t.map((function(e,t){return function(e,t){var n=t.toString();return Object(x.jsxs)("div",{children:[Object(x.jsx)("table",{children:Object(x.jsx)("tbody",{children:Object(x.jsxs)("tr",{className:"searchTr",onClick:Object(o.a)(Object(c.a)().mark((function t(){return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,be(e.id);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))),children:[Object(x.jsx)("td",{className:"bookData",children:e.id}),Object(x.jsx)("td",{className:"bookData",children:e.name}),Object(x.jsx)("td",{className:"bookData",children:e.state}),Object(x.jsx)("td",{className:"bookData",children:e.rent})]},n)})}),e.id===se.current&&Oe(e.id)]})}(e,t)})),0===t.length&&Object(x.jsx)("table",{children:Object(x.jsx)("tbody",{children:Object(x.jsx)("tr",{children:Object(x.jsx)("td",{colSpan:"3",children:e.text.noEntry})},"None")})})]})},Oe=function(t){var n=e.doc.getRent(t);return Object(x.jsx)(x.Fragment,{children:Object(x.jsx)("table",{children:Object(x.jsxs)("tbody",{children:[Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{id:"id",children:e.text.id}),Object(x.jsx)("th",{id:"rentDate",children:e.text.rentDate}),Object(x.jsx)("th",{id:"returnDate",children:e.text.returnDate})]},"ID"),n.map((function(e,t){return function(e,t){var n=e.id,c=e.rentDate,o=e.retDate,r=e.title,s=t.toString();return Object(x.jsxs)(a.a.Fragment,{children:[Object(x.jsxs)("tr",{className:"bookData",children:[Object(x.jsx)("td",{className:"bookData",children:Object(x.jsx)(ee.b,{to:"/search/"+n,children:n})}),Object(x.jsx)("td",{className:"bookData",children:c}),Object(x.jsx)("td",{className:"bookData",children:o})]},s),Object(x.jsx)("tr",{className:"bookName",children:Object(x.jsx)("td",{colSpan:"3",className:"bookName",children:r})},s+"Title")]},s+"Fragment")}(e,t)})),0===n.length&&Object(x.jsx)("tr",{children:Object(x.jsx)("td",{colSpan:"3",children:e.text.noEntry})},"None")]})})})};return Object(r.useEffect)((function(){function e(e){return t.apply(this,arguments)}function t(){return(t=Object(o.a)(Object(c.a)().mark((function e(t){var n,o,r;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],e.t0=Object(c.a)().keys(W);case 2:if((e.t1=e.t0()).done){e.next=10;break}if(o=e.t1.value,r=W[o],!(n.length>=b)){e.next=7;break}return e.abrupt("break",10);case 7:(r.name&&r.name.toString().includes(t)||r.id.toLowerCase()===t.toLowerCase())&&n.push(r),e.next=2;break;case 10:return n.sort((function(e,t){return e.text>t.text})),e.abrupt("return",n);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function n(){return(n=Object(o.a)(Object(c.a)().mark((function t(){var n;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!h){t.next=8;break}return t.next=3,e(h);case 3:(n=t.sent).length>0?v(n):v([]),1===n.length&&ae(n[0].index),t.next=9;break;case 8:v([]);case 9:ce(0);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){n.apply(this,arguments)}()}),[h,e]),Object(x.jsxs)("div",{id:"checkOut",children:[Object(x.jsx)("div",{id:"title",children:Object(x.jsx)("h2",{children:e.text.userSearch})}),Object(x.jsxs)("div",{id:"checkOutInput",hidden:!e.doc.admin,children:[Object(x.jsx)("input",{type:"text",id:"searchInput",placeholder:e.text.idHolder,value:s,onChange:function(e){i(e.target.value)}}),Object(x.jsx)("div",{children:Object(x.jsx)(J,{list:p,showCallback:function(e){return je(e)}})})]})]})},de={LoggedOut:0,LoggingIn:1,LoggedIn:2};var ue=function(e){var t=Object(r.useState)(""),n=Object(l.a)(t,2),s=(n[0],n[1],Object(r.useState)("")),i=Object(l.a)(s,2),d=(i[0],i[1],Object(r.useState)([])),b=Object(l.a)(d,2),j=b[0],h=b[1],f=Object(r.useState)(!1),g=Object(l.a)(f,2),p=g[0],v=g[1],m=Object(r.useState)(""),k=Object(l.a)(m,2),S=k[0],y=(k[1],Object(r.useState)(de.LoggedOut)),I=Object(l.a)(y,2),E=(I[0],I[1],Object(r.useState)([])),C=Object(l.a)(E,2),R=(C[0],C[1]),D=Object(N.b)(M),A=D.loading,T=D.data,_=D.error,L=Object(w.a)(K,{variables:{user_id:S}}),U=Object(l.a)(L,2),P=(U[0],U[1].data),B=Object(r.useState)(""),H=Object(l.a)(B,2),F=(H[0],H[1]),z=Object(r.useState)(""),V=Object(l.a)(z,2),Y=(V[0],V[1],Object(r.useState)(0)),q=Object(l.a)(Y,2),G=q[0],Q=q[1],W=Object(r.useState)([]),Z=Object(l.a)(W,2),X=(Z[0],Z[1]),$=Object(r.useState)({}),te=Object(l.a)($,2),ne=te[0],ce=te[1];function oe(e,t){return e.rentDate>t.rentDate}function re(){return ae.apply(this,arguments)}function ae(){return(ae=Object(o.a)(Object(c.a)().mark((function t(){var n;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("All data loaded "+p),(n=e.doc.getRent()).sort(oe),h(n),console.log("Done"),v(!0);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}Object(r.useEffect)((function(){function t(){return(t=Object(o.a)(Object(c.a)().mark((function t(){var n;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.doc.isOpen()?re():e.doc.setCallback(re),console.log("======================================="),console.log("RentHistory initialize"),n=new Date,2,n.setTime(n.getTime()+1728e5),F(n.toGMTString());case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[]),Object(r.useEffect)((function(){if(console.log("User list loaded"),console.log(_),console.log(A),T){var t=[];console.log("User list available");e.text.normal,e.text.overDue,e.text.stopped;for(var n=0;n<T.users.length;n++){var c=T.users[n],o={id:c._id,name:c.name,level:c.level,state:O(e.text,c.state)};t.push(o)}e.doc.setUser(t),ce(e.doc.getUser())}}),[T,A,_]),Object(r.useEffect)((function(){var t=[];if(P&&e.doc.bookReady&&e.doc.rentReady){console.log("History updated ");for(var n=0;n<P.rentLogs.length;n++){var c=P.rentLogs[n];if("0"===c.book_state||"1"===c.book_state){var o=c.book_id,r=c.timestamp.split(" ")[0].replace("-","/",2).replace("-","/");t.push({id:o,title:e.doc.book[o].title,date:r,state:c.book_state})}}t.sort((function(e,t){return e.date>t.date}));for(var a=[],s=0;s<t.length-1;s++)if("1"===t[s].state)for(var i=t[s],l=i.id,d=s+1;d<t.length;d++)if("0"===t[d].state&&l===t[d].id){a.push({id:i.id,title:i.title,rentDate:i.date,retDate:t[d].date});break}console.log("Set history"),R(a)}}),[P,e.doc.bookReady,e.doc.rentReady]);var se=function(t){return Object(x.jsx)("div",{children:Object(x.jsx)("table",{children:Object(x.jsxs)("tbody",{children:[Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{id:"id",children:e.text.id}),Object(x.jsx)("th",{id:"rentDate",children:e.text.rentDate}),Object(x.jsx)("th",{id:"returnDate",children:e.text.returnDate})]},"ID"),t&&t.map((function(e,t){return function(e,t){var n,c=e.id,o=e.rentDate,r=e.retDate,s=e.title,i=e.user,l=t.toString();return n=ne&&i in ne?ne[i].name:"",Object(x.jsxs)(a.a.Fragment,{children:[Object(x.jsxs)("tr",{className:"bookTop",children:[Object(x.jsx)("td",{className:"bookCell",children:Object(x.jsx)(ee.b,{to:"/search/"+c,children:c})}),Object(x.jsx)("td",{className:"bookCell",children:o}),Object(x.jsx)("td",{className:"bookCell",children:r})]},l),Object(x.jsxs)("tr",{className:"bookRow",children:[Object(x.jsxs)("td",{className:"bookCell",children:[" ",e.user," "]}),Object(x.jsxs)("td",{colSpan:"2",className:"bookCell",children:[" ",n," "]})]},l+"Renter"),Object(x.jsx)("tr",{className:"bookBottom",children:Object(x.jsx)("td",{colSpan:"3",className:"bookCell",children:s})},l+"Title")]},l+"Fragment")}(e,t)})),t&&0===t.length&&Object(x.jsx)("tr",{children:Object(x.jsx)("td",{colSpan:"3",children:e.text.noEntry})},"None")]})})})};return Object(r.useEffect)((function(){var e=j.length;if(console.log("Page num "+G.toString()),e>u){var t=G*u,n=Math.min(u,e-t);X(j.slice(t,t+n))}else X(j),Q(0)}),[j,G]),Object(x.jsxs)("div",{id:"checkOut",children:[Object(x.jsx)("div",{id:"title",children:Object(x.jsx)("h2",{children:e.text.history})}),Object(x.jsx)("div",{id:"checkOutResult",children:Object(x.jsx)(J,{list:j,showCallback:function(e){return se(e)}})})]})},be=(n(248),n(11)),je=n(12),Oe=function(){function e(){Object(be.a)(this,e),console.log("Create Doc class"),this.initialized=!1,this.bookReady=!1,this.rentReady=!1,this.userReady=!1,this.logged=!1,this.userInfo={},this.book={},this.rent={},this.logCallback=void 0,this.admin=!1,this.adminMode=!1,this.serverInfo={},this.serverAvailable=!1,this.ipAddr=""}return Object(je.a)(e,[{key:"updateIpAddr",value:function(){var e=Object(o.a)(Object(c.a)().mark((function e(){var t,n;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W.a.get("https://api.ipify.org/?format=json");case 2:t=e.sent,console.log("Get IP Address"),console.log(t.data),n=t.data.ip,console.log("IP addr updated "+n),this.ipAddr=n,this.checkServerIp();case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkServerIp",value:function(){if(0!==this.ipAddr.length&&this.serverInfo.globalIp&&this.serverInfo.globalIp===this.ipAddr){console.log("Server is accessible "+this.serverInfo.localIp),this.serverAvailable=!0;var e="https://"+this.serverInfo.localIp+":"+this.serverInfo.port+"/check";W.a.get(e).then((function(e){console.log("Server connected"),console.log(e.data)}))}}},{key:"checkState",value:function(){this.bookReady&&this.rentReady&&(this.initialized=!0,d.c.dismiss(),this.callback&&this.callback())}},{key:"setLogCallback",value:function(e){this.logCallback=e}},{key:"setRent",value:function(e){this.rent=e,this.rentReady=!0,this.checkState(),this.checkRent()}},{key:"setServerInfo",value:function(e){this.serverInfo=e,console.log(this.serverInfo.globalIp),this.checkServerIp()}},{key:"setBook",value:function(e){this.book={};for(var t=0;t<e.length;t++){var n=e[t],c=n._id;this.book[c]=n}this.bookReady=!0,this.checkState()}},{key:"setUser",value:function(e){this.user={};for(var t=0;t<e.length;t++){var n=e[t],c=n.id;this.user[c]=n,this.user[c].rent=0}this.userReady=!0,this.checkRent()}},{key:"checkRent",value:function(){if(this.userReady&&this.rentReady){console.log(this.rent);for(var e=0;e<this.rent.length;e++){var t=this.rent[e].state;if("1"===t||"3"===t){var n=this.rent[e].user_id;console.log(n),console.log(n.length),n&&n.length>0&&n in this.user?this.user[n].rent+=1:this.user[n].rent=1}}console.log(this.user)}else console.log("Cannot check rent")}},{key:"setAdminMode",value:function(e){this.adminMode=e,this.logCallback&&this.logCallback(!0)}},{key:"logIn",value:function(e){console.log("Logged in: "+e._id),this.logged=!0,this.userInfo=e,"2"===e.level&&(this.admin=!0),this.logCallback&&this.logCallback(!0)}},{key:"logOut",value:function(){console.log("Logged out"),this.logged=!1,this.userInfo={},this.logCallback&&this.logCallback(!1)}},{key:"getRent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=[];if(console.log("Check "+e),!this.bookReady)return t;for(var n=0;n<this.rent.length;n++){var c=this.rent[n];if((void 0===e||c.user_id===e)&&("1"===c.state||"3"===c.state)){var o=c.book_id,r=this.book[o],a={};a.id=r._id,a.title=r.title,a.rentDate=c.rent_date.split(" ")[0].replace("-","/",2).replace("-","/"),a.retDate=c.return_date.split(" ")[0].replace("-","/",2).replace("-","/"),a.user=c.user_id,t.push(a)}}return t}},{key:"getUser",value:function(){return this.user}},{key:"openDoc",value:function(){var e=Object(o.a)(Object(c.a)().mark((function e(){return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,this.initialized=!0,e.next=8;break;case 4:return e.prev=4,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",!1);case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(){return e.apply(this,arguments)}}()},{key:"isOpen",value:function(){return this.initialized}},{key:"setCallback",value:function(e){console.log("Update function registered"),this.callback=e}}]),e}(),he=Oe,fe=n(219),ge=new(n(249))(fe.privateKey),pe=function(){function e(){Object(be.a)(this,e),console.log("Create Context"),console.log("Cookies");var t=document.cookie;this.cookie=t.split(";").map((function(e){return e.split("=")})).reduce((function(e,t){var n=t.shift().trim(),c=t.join("=").trim();return e[decodeURIComponent(n)]=decodeURIComponent(c),e}),{}),console.log(this.cookie)}return Object(je.a)(e,[{key:"checkLogIn",value:function(e,t){var n,c=!1;if(e.user&&t.length>0){console.log("User data available");var o=e.user.encrypted_email,r=e.user.encrypted_phone;if(n=ge.sign(t,"base64"),t===o||t===r)n=t,c=!0;else if(o===n)c=!0;else{for(var a="",s=0;s<t.length;s++)isNaN(t[s])||(a+=t[s]);(n=ge.sign(a,"base64"))===r&&(c=!0)}}if(c){var i=new Date;i.setTime(i.getTime()+1728e5);var l=i.toGMTString();document.cookie="password="+n+"; expires="+l+";"}return c}}]),e}(),xe=n(152),ve=n(220);n(369),n(370);var me=function(e){var t=Object(r.useState)(!1),n=Object(l.a)(t,2),c=n[0],o=n[1],a=Object(r.useState)(!1),s=Object(l.a)(a,2),i=s[0],d=s[1];return Object(r.useEffect)((function(){c!==e.dropdown&&(console.log("User clicked "+e.doc.logged),console.log(e.dropdown),d(!i),o(e.dropdown));var t=document.getElementById("dropdown-menu");i?t.classList.add("is-show"):t.classList.remove("is-show")}),[e.dropdown,c,i]),Object(x.jsxs)("div",{id:"dropdown-menu",onClick:function(){d(!i)},className:"dropdown-menu",children:[!e.doc.serverAvailable&&e.doc.logged&&Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("div",{className:"menu-items",children:e.doc.userInfo._id+" : "+e.doc.userInfo.name+e.text.nameSuffix}),Object(x.jsx)("hr",{className:"hline"})]}),Object(x.jsx)(ee.b,{className:"menu-items",to:"/",onClick:function(){return d(!1)},children:e.text.home}),Object(x.jsx)(ee.b,{className:"menu-items",to:"/notice",onClick:function(){return d(!1)},children:e.text.notice}),Object(x.jsx)(ee.b,{className:"menu-items",to:"/search",onClick:function(){return d(!1)},children:e.text.bookSearch}),e.doc.serverAvailable&&Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(ee.b,{className:"menu-items",to:"/checkOut",onClick:function(){return d(!1)},children:e.text.checkOut}),Object(x.jsx)(ee.b,{className:"menu-items",to:"/return",onClick:function(){return d(!1)},children:e.text.return})]}),!e.doc.serverAvailable&&e.doc.logged&&Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(ee.b,{className:"menu-items",to:"/checkOutStatus",onClick:function(){return d(!1)},children:e.text.checkOutStatus}),e.doc.admin&&Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("hr",{className:"hline"}),Object(x.jsx)(ee.b,{className:"menu-items",to:"/userSearch",onClick:function(){return d(!1)},children:e.text.userSearch}),Object(x.jsx)(ee.b,{className:"menu-items",to:"/rentHistory",onClick:function(){return d(!1)},children:e.text.history})]}),Object(x.jsx)("hr",{className:"hline"}),Object(x.jsx)("div",{className:"menu-items",onClick:function(){return d(!1),e.doc.logOut(),document.cookie="user_id=",document.cookie="password=",void(document.cookie="autoLogin=false")},children:e.text.logOut})]}),!e.doc.serverAvailable&&!e.doc.logged&&Object(x.jsx)(x.Fragment,{children:Object(x.jsx)(ee.b,{className:"menu-items",to:"/checkOutStatus",onClick:function(){return d(!1)},children:e.text.logIn})})]})},ke=n(221),Se=n.n(ke);var ye=function(e){var t=Object(r.useState)(!1),n=Object(l.a)(t,2),c=n[0],o=n[1];return Object(x.jsx)(x.Fragment,{children:Object(x.jsxs)("div",{id:"navbar",className:"navbar",children:[Object(x.jsx)("div",{className:"title",children:ve.isMobile?Object(x.jsx)("h1",{children:e.text.titleShort}):Object(x.jsx)("h1",{children:e.text.titleLong})}),Object(x.jsx)("div",{className:"menu",onClick:function(){var e=document.getElementById("navbar").style.maxWidth;console.log("maxWidth"),console.log(e),console.log(document.getElementById("navbar").style.width),o(!c)},children:Object(x.jsx)(Se.a,{className:"img",fontSize:"large",sx:{color:"#ffffff"}})}),Object(x.jsx)(me,{text:e.text,doc:e.doc,dropdown:c})]})})},Ie=new he,Ee=new pe,Ce={},Re="";var Ne=function(){var e=Object(r.useState)(!1),t=Object(l.a)(e,2),n=t[0],a=t[1],s=Object(r.useState)(""),i=Object(l.a)(s,2),u=i[0],b=i[1],O=Object(N.b)(B),h=O.loading,f=O.error,p=O.data,v=Object(N.b)(V),m=v.loading,k=v.error,S=v.data,y=Object(w.a)(P),I=Object(l.a)(y,2),E=I[0],C=I[1],D=C.loading,A=C.error,T=C.data,_=Object(w.a)(H,{variables:{_id:u}}),L=Object(l.a)(_,2),U=L[0],M=L[1].data;function K(){var e=j;e.type=d.c.TYPE.SUCCESS,e.render=Ce.succeededToOpen,e.autoClose=3e3,e.toastId="",d.c.info(Ce.succeededToOpen,e)}function F(e){console.log("==== Update logging state "+Ie.logged),console.log(Ie.userInfo),a(Ie.logged)}return Object(r.useEffect)((function(){function e(){return(e=Object(o.a)(Object(c.a)().mark((function e(){var t,n,o;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o in console.log("Initialize app"),Re+="<p>Initialize app</p>",console.log(Object({NODE_ENV:"production",PUBLIC_URL:"/hkmcclib",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_NAME:"library",REACT_APP_VERSION:"0.5.2"}).APP_NAME),console.log(Object({NODE_ENV:"production",PUBLIC_URL:"/hkmcclib",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_NAME:"library",REACT_APP_VERSION:"0.5.2"}).APP_VERSION),t=navigator.languages,console.log(t),n={},n=t.length>0&&(t[0].toLowerCase().includes("kr")||t[0].toLowerCase().includes("ko"))?xe.kr:xe.en)Ce[o]=n[o];return e.next=11,Ie.updateIpAddr();case 11:"autoLogin"in Ee.cookie&&"true"===Ee.cookie.autoLogin&&(console.log("Auto Login: "+Ee.cookie.user_id),b(Ee.cookie.user_id),console.log(Ee.cookie.nothing),U());case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[U]),Object(r.useEffect)((function(){console.log("User data loaded"),M&&(console.log("Login check "+Ee.cookie.password),console.log(M),Ee.cookie.password&&Ee.checkLogIn(M,Ee.cookie.password)&&(console.log("Login suceeded"),Ie.logIn(M.user)))}),[M]),Object(r.useEffect)((function(){console.log("Rent Query Updated"),Re=Re+"<p>Rent Query Updated "+h+" "+f+"</p>",console.log(h),console.log(f),p&&(console.log("Rent available"),Re+="<p>Rent available</p>",Ie.setRent(p.rents),Ie.initialized&&K())}),[h,f,p]),Object(r.useEffect)((function(){console.log("Book Query Updated"),Re+="<p>Book Query Updated</p>",console.log(D),console.log(A),T&&(console.log("Book available"),Re+="<p>Book available</p>",Ie.setBook(T.books),Ie.initialized&&K())}),[D,A,T]),Object(r.useEffect)((function(){if(console.log("Server Query Updated"),Re+="<p>Server Query Updated</p>",console.log(m),console.log(k),S&&(console.log("Server info available"),Re+="<p>Server info available</p>",console.log(S.serverInfo),Ie.setServerInfo(S.serverInfo),!Ie.serverAvailable)){console.log("Server is not available. Load books from cloud DB"),E();var e=j;e.type=d.c.TYPE.LOADING,e.autoClose=!1,e.toastId=g,d.c.loading(Ce.loading,e),Ie.setLogCallback(F)}}),[m,k,S]),Object(x.jsx)(ee.a,{children:Object(x.jsxs)("div",{className:"App",children:[Object(x.jsx)("div",{children:Object(x.jsx)(d.a,{newestOnTop:!0,closeOnClick:!0,rtl:!1,draggable:!0,pauseOnHover:!0,pauseOnFocusLoss:!1,transition:d.b,limit:10})}),Object(x.jsx)(ye,{doc:Ie,text:Ce}),Object(x.jsxs)(Q.c,{children:[Object(x.jsx)(Q.a,{path:"/",element:Object(x.jsx)(R,{doc:Ie,text:Ce})}),Object(x.jsx)(Q.a,{path:"/notice",element:Object(x.jsx)(Y,{doc:Ie,text:Ce})}),Object(x.jsx)(Q.a,{path:"/search/:id?",element:Object(x.jsx)($,{doc:Ie,text:Ce})}),Object(x.jsx)(Q.a,{path:"/checkOutStatus",element:Object(x.jsx)(ne,{context:Ee,doc:Ie,text:Ce,logged:n})}),Object(x.jsx)(Q.a,{path:"/userSearch",element:Object(x.jsx)(le,{context:Ee,doc:Ie,text:Ce})}),Object(x.jsx)(Q.a,{path:"/checkOut",element:Object(x.jsx)(ae,{context:Ee,doc:Ie,text:Ce})}),Object(x.jsx)(Q.a,{path:"/return",element:Object(x.jsx)(ie,{context:Ee,doc:Ie,text:Ce})}),Object(x.jsx)(Q.a,{path:"/rentHistory",element:Object(x.jsx)(ue,{context:Ee,doc:Ie,text:Ce})})]}),Object(x.jsxs)("h3",{children:["v ","0.5.2"]})]})})},we=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,397)).then((function(t){var n=t.getCLS,c=t.getFID,o=t.getFCP,r=t.getLCP,a=t.getTTFB;n(e),c(e),o(e),r(e),a(e)}))},De=n(153),Ae=n(394),Te=n(393),_e=n(395),Le=n(391),Ue="data-xaque",Pe="https://realm.mongodb.com/api/client/v2.0/app/".concat(Ue,"/graphql"),Be=new De.a(Ue);function Me(){return He.apply(this,arguments)}function He(){return(He=Object(o.a)(Object(c.a)().mark((function e(){return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.currentUser){e.next=5;break}return e.next=3,Be.logIn(De.b.anonymous());case 3:e.next=7;break;case 5:return e.next=7,Be.currentUser.refreshAccessToken();case 7:return e.abrupt("return",Be.currentUser.accessToken);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ke=new Ae.a({link:new Te.a({uri:Pe,fetch:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=Object(o.a)(Object(c.a)().mark((function e(t,n){var o;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Me();case 2:return o=e.sent,n.headers.Authorization="Bearer ".concat(o),e.abrupt("return",fetch(t,n));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}),cache:new _e.a});i.a.render(Object(x.jsx)(a.a.StrictMode,{children:Object(x.jsx)(Le.a,{client:Ke,children:Object(x.jsx)(Ne,{})})}),document.getElementById("root")),we()},62:function(e,t,n){}},[[372,1,2]]]);
//# sourceMappingURL=main.d6747980.chunk.js.map